<details itemscope itemtype='/pages' itemid='<%=page.id%>' data-author_state="<%=page.author_state%>">
  <summary>
    <h2 itemprop="title"><%=page.title%></h2>
    <figure>
      <img itemprop="thumbnail_url" src="<%=page.thumbnail_url%>" alt="tip image" title="<%=page.title%>"/> 
      <figcaption><%=page.fan_tips(current_user).sum(:amount_in_cents)%></figcaption>
    </figure>
  </summary>
  <dl>
    <dt>Source</dt>
    <dd><a itemprop="url" target="_blank" href="<%=page.url%>"><%=URI(page.url).host%></a></dd>
    <dt>
      <details>
        <summary><%=pluralize(page.fan_tips(current_user).count, 'tip')%></summary>
        <table>
          <thead>
            <tr>
              <th>when</th>
              <th>amount</th>
              <th>delete</th>
            </tr>
          </thead>
          <tbody>
            <%-page.fan_tips(current_user).each do |tip| -%>
            <tr itemscope itemtype='tips' itemid='<%=tip.id%>'>
              <td><time datetime="<%=tip.created_at.getutc.iso8601%>" /></td>
              <td>
                <%-if tip.paid_state == 'promised' -%>
                  <form method="put">
                    <input type="text" name='amount_in_dollars' value="<%=tip.amount_in_cents%>"/>
                    <input type="submit" value="Save"/>
                    <input type="hidden" itemprop="amount_in_cents" name="tip[amount_in_cents]" value="<%=tip.amount_in_cents%>"/>
                  </form>
                <%-else-%>
                  <span itemprop='amount_in_cents' data-amount_in_cents='<%=tip.amount_in_cents%>'><%=tip.amount_in_cents%></span>
                <%-end-%>
              </td>
              <td>
                <%-if tip.paid_state == 'promised' -%>
                  <form method="delete"><input type="submit" value="X"/></form>
                <%-end-%>
              </td>
            </tr>
          <%-end-%>
          </tbody>
        </table>
      </details>          
    </dt>
  </dl>        
</details>