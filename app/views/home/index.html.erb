<%-cache current_user do-%>
  <section id="banner">
    <header>
      <a href=/><%= image_tag "icons/silhouette.svg", class:"author", alt:'me' %></a>
    </header>
    <hgroup>
      <h1>what you love</h1>
      <p><%=current_user.name%><a href="/signout">not you?</a></p>
    </hgroup>
    <%-unless current_user.created_at < 7.days.ago-%>
    <p>
      This is your home on Copper. On this page, you track what
      youâ€™ve tipped, change or cancel pending tips, and explore content made
      by your favorite creators. 
    </p>
    <%-end-%>
  </section>
  <section id="stats">
    <header></header>
    <div>
      <h2>Pages tipped</h2>
      <p><%=current_user.tipped_pages.length%></p>
    </div>
    <div>
      <h2>Average tip</h2>
      <p data-cents='<%=current_user.tips.average(:amount_in_cents).round() if current_user.tips.size > 0%>'></p>
    </div>
    <div>
      <h2>Default tip</h2>
      <p>
        <span itemprop="tip_preference_in_cents"></span>
        <button>+</button>
        <button>-</button>
      </p>
    </div>
    <footer></footer>
  </section>

  <%-if current_user.pages.count > 0 -%>
    <section id="pages">
      <%= render partial:"pages/details", collection:current_user.tipped_pages.limit(60), as: :page %>
    </section>
  <%-else-%>
    <%= render partial:"shared/button"%>
    <section id="congrats">
      <header>
        <h3>Congrats!</h3>
        <h1>Your button is installed!</h1>
      </header>
    </section>
    <section id="card">
      <header>
        <h3>All the cool kids are tipping with real money</h3>
        <p>
          Here's the fine print: If you tip someone a buck, 
          they get paid a buck. We charge you 10% for the service.
        </p>
      </header>
      <%= render partial:'shared/card' %>
      <figure>
        <%=image_tag "noun_project/3879.svg"%>
      </figure>
    </section>
  <%-end-%>
<%-end-%>
