<%-content_for :head do-%>
  <title><%=current_user.name%> - Copper.</title>

  <link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/aoioappfaobhjafcnnajbndogjhaodpb">
<%-end-%>

<section id="banner">
  <header>
    <%= image_tag "icons/silhouette.svg", class:"identity", alt:'me' %>
  </header>
  <hgroup>
    <h1>Your Profile</h1>
    <p><%=current_user.name%><a href="/signout">not you?</a></p>
  </hgroup>
  <p>
    This is your home on Copper. On this page, you can keep track of what
    you’ve tipped, change or cancel pending tips, and explore content made
    by your favorite creators. We also save the things you’ve tipped so you
    can find them later to enjoy or share with your friends.
  </p>
</section>
<section id="stats">
  <header>
    <h1>Your stats</h1>
  </header>
  <div>
    <h2>Pages tipped</h2>
    <p><%=current_user.pages.count%></p>
  </div>
  <div>
    <h2>Average tip</h2>
    <p><%=current_user.tips.average(:amount_in_cents).round() if current_user.tips.size > 0%></p>
  </div>
  <div>
    <h2>Default tip</h2>
    <p>
      <span itemprop="tip_preference_in_cents" data-value="<%=current_user.tip_preference_in_cents%>"></span>
      <button>+</button>
      <button>-</button>
    </p>
  </div>
  <footer>
    <a href="/settings">Edit your settings</a>
  </footer>
</section>
<%-if @pages.length > 0 -%>
  <section id="pages" class="">
    <header>
      <h1>What you've tipped</h1>
      <hgroup>
        <h2>Filter by</h2>
        <nav>
          <a href="#pages/recent" class="selected">recent</a>
          <a href="#pages/adopted">adopted <span><%=current_user.pages.adopted.count%></span></a>
          <a href="#pages/fostered">fostered <span><%=current_user.pages.fostered.count%></span></a>
          <a href="#pages/manual">manual <span><%=current_user.pages.manual.count%></span></a>
          <a href="#pages/orphaned">orphaned <span><%=current_user.pages.orphaned.count%></span></a>
          <a href="#pages/author">author</a>
          <a href="#pages/site">site</a>
        </nav>
      </hgroup>
    </header>
    <%-@pages.each do |page| -%>
      <details itemscope itemtype='/pages' itemid='<%=page.id%>' data-author_state="<%=page.author_state%>">
        <summary>
          <h2 itemprop="title"><%=page.title%></h2>
          <figure>
            <img itemprop="thumbnail_url" src="<%=page.thumbnail_url%>" alt="tip image" title="<%=page.author_state%>"/> 
            <figcaption><%=page.fan_tips(current_user).sum(:amount_in_cents)%></figcaption>
          </figure>
        </summary>
        <dl>
          <dt>Source</dt>
          <dd><a itemprop="url" target="_blank" href="<%=page.url%>"><%=URI(page.url).host%></a></dd>
          <dt>
            <details>
              <summary><%=pluralize(page.fan_tips(current_user).count, 'tip')%></summary>
              <table>
                <thead>
                  <tr>
                    <th>when</th>
                    <th>amount</th>
                    <th>delete</th>
                  </tr>
                </thead>
                <tbody>
                  <%-page.fan_tips(current_user).each do |tip| -%>
                  <tr itemscope itemtype='tips' itemid='<%=tip.id%>'>
                    <td><time datetime="<%=tip.created_at.getutc.iso8601%>" /></td>
                    <td>
                      <%-if tip.paid_state == 'promised' -%>
                        <form method="put">
                          <input type="text" name='amount_in_dollars' value="<%=tip.amount_in_cents%>"/>
                          <input type="submit" value="Save"/>
                          <input type="hidden" itemprop="amount_in_cents" name="tip[amount_in_cents]" value="<%=tip.amount_in_cents%>"/>
                        </form>
                      <%-else-%>
                        <span itemprop='amount_in_cents' data-amount_in_cents='<%=tip.amount_in_cents%>'><%=tip.amount_in_cents%></span>
                      <%-end-%>
                    </td>
                    <td>
                      <%-if tip.paid_state == 'promised' -%>
                        <form method="delete"><input type="submit" value="X"/></form>
                      <%-end-%>
                    </td>
                  </tr>
                <%-end-%>
                </tbody>
              </table>
            </details>          
          </dt>
        </dl>        
      </details>
    <%-end-%>
  </section>
<%-else-%>
  <section id="join">
    <header>
      <p>
        You’re now officially a fan on Copper. As soon as you
        have the button, you can start tipping!
      </p>
    </header>
    <figure class="step_two">
      <a class="button install get"><%= image_tag "icons/letter_logo_white.svg"%> Get The Button</a>
      <%= image_tag "arrows/right_two.svg"%>
      <a class="button">Start Tipping</a>
    </figure>
  </section>
  <section id="congrats">
    <header>
      <h3>Congrats!</h3>
      <h1>Your button is now installed! Take it for a test drive...</h1>
    </header>
    <p>
      Below are some things we have transferred from your News Feed
      that you might want to tip! But of course, the tip button
      works anywhere.
    </p>
    <p class="sub">
      Note: We won’t ask for any payment info until you've been using
      the service for a bit, but if you want to get that squared away now,
      you can do that <a href="/fans/me/edit">here</a>.
    </p>
  </section>
  <section id="facebook">
    <h4><%=image_tag "providers/facebook/thumb.png"%></h4>
    <nav></nav>
  </section>
<%-end-%>
