//= require shared/common
window.addEventListener('message', function(event) {
  $(document).trigger(JSON.parse(event.data))
});
document.postMessage = function (message){
  window.parent.postMessage(message, "*");
}
$(document).ready(function (){
  document.postMessage(JSON.stringify({type:'tip_info'}))
});
$(document).bind({
  "tip_info": function (event){
    console.debug("tip_info")
    title = decodeURIComponent(event.title)
    new_tip = document.getItems('tips').create
    new_tip.title = decodeURIComponent(event.title)
    new_tip.url = decodeURIComponent(event.url)
    Item.update_page(new_tip)
    Copper.format_cents_to_dollars("amount_in_cents")
    $(document).trigger("tip_display")
  },
  "tip_display": function (event){
    console.debug("tip_display")
    document.postMessage(JSON.stringify({type:'show'}))
    $("body > section").addClass("show")
    window.setTimeout(function (){
      $("body > section").removeClass('show')
    },3000);
    window.setTimeout(function (){
      document.postMessage(JSON.stringify({type:'hide'}))

      $("form").submit()
    },4000);
  }
});
