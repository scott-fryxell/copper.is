//= require jquery
//= require jquery.cookie
//= require jquery.timeago
//= require jquery.tmpl
//= require shared/Item
//= require shared/copper
window.addEventListener('message', function(event) {
  $(document).trigger(JSON.parse(event.data))
});
document.postMessage = function (message){
  window.parent.postMessage(message, "*");
}
$(document).ready(function (){
  document.postMessage(JSON.stringify({type:'tip_info'}))
});
$(document).bind({
  "tip_info": function (event){
    title = decodeURIComponent(event.title)
    new_tip = document.getItems('tips').new
    new_tip.title = decodeURIComponent(event.title)
    new_tip.url = decodeURIComponent(event.url)
    Item.update_page(new_tip)
    copper.format_cents_to_dollars("amount_in_cents")

    jQuery('<img/>', {
      id: 'create_img',
      src: 'http://img.bitpixels.com/getthumbnail?code=59482&size=200&url='+new_tip.url,
      style: 'opacity:0;'
    }).appendTo('body');

    $(document).trigger("tip_display")
  },
  "tip_display": function (event){
    
    $("body > form").submit()
    document.postMessage(JSON.stringify({type:'show'}))
    $("body > section").addClass("show")

    window.setTimeout(function (){
      $("body > section").removeClass('show')
    },3000);

    window.setTimeout(function (){
      document.postMessage(JSON.stringify({type:'hide'}))
    },4000);
  }
});

$(document).bind("copper:update_page_items", function(){
  copper.format_cents_to_dollars("amount_in_cents") 
});
