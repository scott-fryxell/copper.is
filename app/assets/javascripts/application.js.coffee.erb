#= require mustache
#= require jquery
#= require jquery.cookie
#= require jquery.timeago
#= require jquery.tmpl
#= require jquery.browser
#= require jquery.details
#= require Item
#= require shared/Item
#= require shared/copper
#= require shared/button
#= require shared/address
#= require shared/card
#= require shared/email
#= require shared/badge
#= require shared/tips
#= require shared/honeybadger
#= require home/index
#= require home/author
#= require home/settings
#= require home/badge
#= require home/welcome
#= require home/getting_started
#= require pages/index
#= require pages/show
#= require authors/edit
#= require orders/index
#= require admin/index

$(document).ready ->

  $("a[href^=#]").click ->
    event.preventDefault();
    history.pushState({}, "", @.href)
  
  $('#admin > img.toggle').click ->
    $('#admin').toggleClass('hide')

  jQuery.ajax
    url:'/users/me.json',
    dataType:'json',
    success: (data) ->
      document.copper.me = data;
      Item.update_page document.copper.me
      $('img.author').attr 'src', document.copper.get_author_image()
      $("#user_nav").addClass 'show'
      $('a[href="/signout"]').css 'display','inline-block'
      $(document).trigger "me." + $('body').attr 'id'
      $('body').addClass("fan")
    statusCode:
      401:->
        $(document).trigger "guest." + $('body').attr 'id'
        $('body').addClass("guest")
    
  $(document).bind 'save.me', ->
    jQuery.ajax
      dataType:'json'
      url: '/users/me.json'
      type: 'put'
      data: jQuery.param document.copper.me
