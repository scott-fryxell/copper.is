//= require jquery
//= require jquery.cookie
//= require jquery.timeago
//= require jquery.tmpl
//= require shared/Item
//= require shared/form
//= require shared/copper
//= require home/index
//= require users/edit
//= require users/show
//= require authors/show
//= require authors/edit
//= require identities/edit

$(document).ready(function() {
  jQuery('time').timeago();
  $(document).trigger("load." + $('body').attr('id'))

  $("#sign_in > nav > a").hover(
    function (){
      $(this).find("img").hide();
      $(this).find("img.hover").show();
    },
    function (){
      $(this).find("img").show();
      $(this).find("img.hover").hide();
    }
  );
  $("img[alt=Gear]").click(function(event){
    $(this).addClass("working");
  });

  jQuery.ajax({url:'/fans/me',
    dataType:'json',
    success:function(data) {
      copper.me = data;
      $('img.identity').attr('src', copper.get_identity_image())
      $("#signed_in").addClass('show')
      $('a[href="/signout"]').css('display','inline-block');
      $(document).trigger("me." + $('body').attr('id'));
    },
    statusCode: {
      401:function (){
        $("#sign_in").addClass('show')
        $("#sign_in > nav > a > img").click(function(event){
          $(this).addClass("working");
        });
      }
    }
  });
  
  $(document).bind('save.me', function(){
    jQuery.ajax({
      dataType:'json',
      url: '/fans/me.json',
      type: 'put',
      data: jQuery.param(copper.me),
      error: function(data, textStatus, jqXHR) {
        $(document).trigger("error.me");
      }
    });
  });
});
