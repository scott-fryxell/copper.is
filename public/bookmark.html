<!DOCTYPE html>
<html lang="en_us" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8"/>
    <title>Bookmarklet</title>
  </head>

  <body id="bookmarklet">
    <script type="text/javascript">
      var patronize_POST = function(){
        var url = window.location;
        var service = 'http://0.0.0.0:3000/patronize';
        var request = new XMLHttpRequest();
        var postBody = encodeURIComponent('patronized') + '=' + encodeURIComponent(window.location);
        console.debug(postBody);
        request.open('POST', service , true);
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        request.setRequestHeader('Content-Length', postBody.length);
        request.setRequestHeader('Connection', 'close');
        request.send( postBody );
        console.debug('url submitted');
      }
    </script>

    <!-- Packed and placed in bookmarklet with http://dean.edwards.name/packer/,
         URL escaped using TextMate HTML bundle. -->
    <script type="text/javascript">
      var patronize = function(w, x) {
        x.open('GET', 'http://0.0.0.0:3000/patronize?patronized=' + encodeURIComponent(w.location));
        x.send();
      };
    </script>

    <ol>
      <li><a href="javascript:var%20patronize%3Dfunction%28w%2Cx%29%7Bx.open%28%27GET%27%2C%27http%3A%2F%2F0.0.0.0%3A3000%2Fpatronize%3Fpatronized%3D%27%2BencodeURIComponent%28w.location%29%29%3Bx.send%28%29%7D%3Bpatronize%28window%2Cnew%20XMLHttpRequest%29%3B">tip this</a></li>
      <li><a href="javascript:patronize_POST()">Patronize POST</a></li>
      <li><a href="javascript:patronize(window,new XMLHttpRequest)">Patronize GET</a></li>
    </ol>

    <pre>
      grab the current window's url.
      GET to /patronize URL
    </pre>

    <form action="http:/0.0.0.0:3000/patronize" method="post" accept-charset="utf-8">
      <input type="hidden" name="patronized" value="http://www.google.com"/>
      <fieldset><input type="submit" value="submit"/></fieldset>
    </form>

  </body>

</html>

